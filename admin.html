<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:20px;border-radius:12px;max-width:500px;margin:auto}
input,button{width:100%;padding:10px;margin-top:6px;border-radius:8px}
.add{background:#4caf50;color:#fff}
.edit{background:#2196f3;color:#fff}
.del{background:#f44336;color:#fff}
.row{border-bottom:1px solid #ddd;padding:8px}
</style>
</head>
<body>

<div class="card">
<h2>Admin</h2>

<h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
<input id="u" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
<input id="p" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏°">
<button class="add" onclick="addPoint()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°</button>

<hr>
<h3>‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
<input id="rname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•">
<input id="rcost" type="number" placeholder="‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ">
<button class="add" onclick="saveReward()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>

<div id="list"></div>

<hr>
<h3>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
<div id="reqList"></div>
</div>

<script>
let rewards=JSON.parse(localStorage.getItem('rewards')||'[]');
let edit=null;

function addPoint(){
 let d=JSON.parse(localStorage.getItem('data')||'{}');
 if(!d[u.value]) d[u.value]={password:'',points:0};
 d[u.value].points+=Number(p.value);
 localStorage.setItem('data',JSON.stringify(d));
 alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°‡πÅ‡∏•‡πâ‡∏ß');
}

function saveReward(){
 if(edit!=null){
  rewards[edit]={name:rname.value,cost:Number(rcost.value)};
  edit=null;
 }else rewards.push({name:rname.value,cost:Number(rcost.value)});
 localStorage.setItem('rewards',JSON.stringify(rewards));
 rname.value=rcost.value='';
 render();
}

function editReward(i){
 rname.value=rewards[i].name;
 rcost.value=rewards[i].cost;
 edit=i;
}

function delReward(i){
 if(confirm('‡∏•‡∏ö?')){
  rewards.splice(i,1);
  localStorage.setItem('rewards',JSON.stringify(rewards));
  render();
 }
}

function render(){
 list.innerHTML='';
 rewards.forEach((r,i)=>{
  list.innerHTML+=`
  <div class="row">
   ${r.name} (${r.cost} ‡πÅ‡∏ï‡πâ‡∏°)
   <button class="edit" onclick="editReward(${i})">‡πÅ‡∏Å‡πâ</button>
   <button class="del" onclick="delReward(${i})">‡∏•‡∏ö</button>
  </div>`;
 });
}
render();

/* ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏Å */
function loadReq(){
 let req=JSON.parse(localStorage.getItem('redeemRequests')||'[]');
 let users=JSON.parse(localStorage.getItem('data')||'{}');
 reqList.innerHTML='';
 req.forEach((r,i)=>{
  reqList.innerHTML+=`
  <div class="row">
   üë§ ${r.user}<br>
   üéÅ ${r.reward} (${r.cost})<br>
   üìå ${r.status}<br>
   ${r.status==='‡∏£‡∏≠‡πÇ‡∏≠‡∏ô'
    ? `<button class="add" onclick="confirmPay(${i})">‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>`:''
   }
  </div>`;
 });
}

function confirmPay(i){
 let req=JSON.parse(localStorage.getItem('redeemRequests'));
 let users=JSON.parse(localStorage.getItem('data'));
 let r=req[i];
 if(users[r.user].points<r.cost)
  return alert('‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠');
 users[r.user].points-=r.cost;
 r.status='‡πÇ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
 localStorage.setItem('data',JSON.stringify(users));
 localStorage.setItem('redeemRequests',JSON.stringify(req));
 loadReq();
}

loadReq();
</script>
</body>
</html>
