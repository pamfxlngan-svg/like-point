<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:20px;border-radius:12px;max-width:420px;margin:auto;box-shadow:0 4px 10px rgba(0,0,0,.1)}
input,button,select{width:100%;padding:10px;margin-top:6px;border-radius:8px}
button{border:none;cursor:pointer}
.add{background:#4caf50;color:#fff}
.redeem{background:#ff9800;color:#fff}
.logout{background:#9e9e9e;color:#fff}

/* Toast */
.toast{
  position:fixed;bottom:30px;left:50%;transform:translateX(-50%);
  background:#323232;color:#fff;padding:12px 18px;border-radius:10px;
  opacity:0;pointer-events:none;transition:.3s;
  box-shadow:0 6px 15px rgba(0,0,0,.25)
}
.toast.show{opacity:1;bottom:45px}
.toast.success{background:#4caf50}
.toast.error{background:#f44336}
</style>
</head>
<body>

<div class="card">
<h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°</h2>

<div id="loginBox">
  <input id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
  <input id="password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
</div>

<div id="app" style="display:none">
  <p>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: <b id="showUser"></b></p>
  <p>‡πÅ‡∏ï‡πâ‡∏°: <b id="points">0</b></p>

  <button class="add" onclick="addPoint()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°</button>

  <h3>‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
  <select id="rewardSelect"></select>
  <button class="redeem" onclick="redeem()">‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>

  <button class="logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>
</div>

<div id="toast" class="toast"></div>

<script>
let data=JSON.parse(localStorage.getItem('data')||'{}');
let rewards=JSON.parse(localStorage.getItem('rewards')||'[]');
let currentUser=localStorage.getItem('currentUser');

if(currentUser && data[currentUser]) showApp(currentUser);
loadRewards();

/* Toast */
function showToast(text,type='success'){
  const t=document.getElementById('toast');
  t.className='toast show '+type;
  t.innerText=text;
  setTimeout(()=>t.className='toast',2500);
}

/* QR ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏° */
const q=new URLSearchParams(location.search);
if(q.get('qr')==='addpoint'){
  if(!currentUser) showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô','error');
  else{
    data[currentUser].points++;
    save(); update();
    showToast('‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏° +1');
  }
  history.replaceState({},'',location.pathname);
}

function save(){
  localStorage.setItem('data',JSON.stringify(data));
  localStorage.setItem('currentUser',currentUser);
}

function login(){
  const u=username.value.trim();
  const p=password.value;
  if(!u||!p) return showToast('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö','error');

  if(!data[u]) data[u]={password:p,points:0};
  else if(data[u].password!==p) return showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á','error');

  currentUser=u; save(); showApp(u);
}

function showApp(u){
  loginBox.style.display='none';
  app.style.display='block';
  showUser.innerText=u;
  update();
}

function update(){ points.innerText=data[currentUser].points }

function addPoint(){
  data[currentUser].points++;
  save(); update();
  showToast('+1 ‡πÅ‡∏ï‡πâ‡∏°');
}

function loadRewards(){
  rewardSelect.innerHTML='';
  if(rewards.length===0){
    rewardSelect.innerHTML='<option>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</option>';return;
  }
  rewards.forEach((r,i)=>{
    rewardSelect.innerHTML+=`<option value="${i}">${r.name} (${r.cost} ‡πÅ‡∏ï‡πâ‡∏°)</option>`;
  });
}

function redeem(){
  if(rewards.length===0) return showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•','error');
  const r=rewards[rewardSelect.value];
  if(data[currentUser].points<r.cost) return showToast('‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠','error');
  data[currentUser].points-=r.cost;
  save(); update();
  showToast('‡πÅ‡∏•‡∏Å '+r.name+' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ');
}

function logout(){
  localStorage.removeItem('currentUser');
  location.reload();
}
</script>
</body>
</html>
